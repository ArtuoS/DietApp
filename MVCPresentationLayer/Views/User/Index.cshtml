@using Newtonsoft.Json;
@using Entities.Enums;
@{ ViewData["Title"] = "Index"; }

<div class="wrapper wrapper-content animated fadeInRight">

    <div class="row m-b-lg m-t-lg">
        <div class="col-md-6">

            <div class="profile-image">
                <img src="~/Images/profile.png" class="rounded-circle circle-border m-b-md" alt="profile">
            </div>
            <div class="profile-info">
                <div class="">
                    <div>
                        <h1 class="no-margins">
                            @User.Identity.Name
                            <!--User.FindFirst("Weight").Value;-->
                        </h1>
                        <p>
                            @User.FindFirst("Email").Value
                        </p>
                        <table class="table small m-b-xs">
                            <tbody>
                                <tr>
                                    <td>
                                        Peso: <strong>@User.FindFirst("Weight").Value<strong>kg</strong></strong>
                                    </td>
                                    <td>
                                        Altura: <strong>@User.FindFirst("Height").Value<strong>cm</strong></strong>
                                    </td>
                                    <td>
                                        Gordura Corporal: <strong>@User.FindFirst("BodyFat").Value<strong>%</strong></strong>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <h3 class="no-margins">Meta diária de nutrientes:</h3>
            <table class="table small m-b-xs">
                <tbody>
                    <tr>
                        <td class="text-success">
                            <strong class="badge-success">
                                @User.FindFirst("Daily_Calories").Value
                            </strong> de Calorias
                        </td>
                        <td class="text-info">
                            <strong class="badge-info">
                                @User.FindFirst("Daily_Carbohydrates").Value
                            </strong> de Carboidratos
                        </td>

                    </tr>
                    <tr>
                        <td class="text-warning">
                            <strong class="badge-warning">
                                @User.FindFirst("Daily_Protein").Value
                            </strong>g de Proteínas
                        </td>
                        <td class="text-danger">
                            <strong class="badge-danger">
                                @User.FindFirst("Daily_Fats").Value
                            </strong> de Gorduras
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="wrapper wrapper-content">
        <div class="row justify-content-md-center">
            <div class="col-lg-10 col-lg-offset-1">
                <div class="ibox">
                    <h1 class="text-center">Dieta do dia </h1>
                    <div class="row justify-content-md-center">
                        <div class="col-lg-3" id="data_3">
                            <div class="input-group date">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input type="text" id="dietDate" value="@DateTime.Today.Date.ToString("dd/MM/yyyy")" class="form-control date">
                            </div>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-lg-8">
                                <div id="vertical-timeline" class="vertical-container light-timeline no-margins">
                                    <div class="vertical-timeline-block">
                                        <div class="vertical-timeline-icon blue-bg">
                                            <i class="fa fa-coffee"></i>
                                        </div>
                                        <div class="vertical-timeline-content">
                                            <h2>Café da manhã</h2>
                                            <div class="dd-nodrag" id="nestable">
                                                <ol class="dd-list">
                                                    <li class="dd-item" data-id="1">
                                                        <div class="dd-handle">
                                                            <div class="tooltip-demo">
                                                                <a class="text-info" id="nameMealBreackfast">Nome da refeição</a><button data-toggle="modal" id="mod" href="#modal-form" class="btn btn-info btn-xs" data-placement="right"><i class="fa fa-lightbulb-o"></i> Detalhes</button>
                                                            </div>
                                                        </div>
                                                        <ol class="dd-list" id="breackfastmealfoods">
                                                        </ol>
                                                    </li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="vertical-timeline-block">
                                        <div class="vertical-timeline-icon red-bg">
                                            <i class="fa fa-cutlery"></i>
                                        </div>
                                        <div class="vertical-timeline-content">
                                            <h2>Almoço</h2>
                                            <div class="dd-nodrag" id="nestable">
                                                <ol class="dd-list">
                                                    <li class="dd-item" data-id="1">
                                                        <div class="dd-handle">
                                                            <div class="tooltip-demo">
                                                                <a class="text-danger" id="nameMeallunch">Nome da refeição</a><button data-toggle="modal" id="mod" href="#modal-form2" class="btn btn-danger btn-xs" data-placement="right"><i class="fa fa-lightbulb-o"></i> Detalhes</button>
                                                            </div>
                                                        </div>
                                                        <ol class="dd-list" id="lunchmealfoods">
                                                        </ol>
                                                    </li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="vertical-timeline-block">
                                        <div class="vertical-timeline-icon yellow-bg">
                                            <i class="fa fa-glass"></i>
                                        </div>
                                        <div class="vertical-timeline-content">
                                            <h2>Janta</h2>
                                            <div class="dd-nodrag" id="nestable">
                                                <ol class="dd-list">
                                                    <li class="dd-item" data-id="1">
                                                        <div class="dd-handle">
                                                            <div class="tooltip-demo">
                                                                <a class="text-warning"  id="nameMealdinner">Nome da refeição</a><button data-toggle="modal" id="mod" href="#modal-form3" class="btn btn-warning btn-xs" data-placement="right" ><i class="fa fa-lightbulb-o"></i> Detalhes</button>
                                                            </div>
                                                        </div>
                                                        <ol class="dd-list" id="dinnermealfoods">
                                                        </ol>
                                                    </li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3" id="sidecolumn">
                                <div id="pie"></div>
                                <ol class="dd-list" id="foodsDetails">
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-form" class="modal fade" aria-hidden="true">
        <div class="modal-dialog  modal-md">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="row">
                                <div class="col-lg-4">
                                    <img id="mealbreackfastImage" alt="image" class="" src="" style="width: 120px">
                                </div>
                                <div class="col-lg-8">
                                    <h3 id="mealBreackfastName"></h3>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <small>Calorias: </small>
                                                    <small id="mealbreackfastCalories"></small>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <small>Carboidratos: </small>
                                                    <small id="mealbreackfastCarbs"></small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <small>Proteínas: </small>
                                                    <small id="mealbreackfastProteins"></small>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <small>Gorduras: </small>
                                                    <small id="mealbreackfastLipids"></small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <h4>Ingredientes</h4>
                                    <ul id="mealbrackfastfoods">
                                    </ul>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <h4>Receita</h4>
                                    <p id="mealBreackfastDescription"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-form2" class="modal fade" aria-hidden="true">
        <div class="modal-dialog  modal-md">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="row">
                                <div class="col-lg-4">
                                    <img id="meallunchImage" alt="image" class="" src="" style="width: 120px">
                                </div>
                                <div class="col-lg-8">
                                    <h3 id="meallunchName"></h3>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <small>Calorias: </small>
                                                    <small id="meallunchCalories"></small>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <small>Carboidratos: </small>
                                                    <small id="meallunchCarbs"></small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <small>Proteínas: </small>
                                                    <small id="meallunchProteins"></small>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <small>Gorduras: </small>
                                                    <small id="meallunchLipids"></small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <h4>Ingredientes</h4>
                                    <ul id="meallunchfoods">
                                    </ul>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <h4>Receita</h4>
                                    <p id="meallunchDescription"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-form3" class="modal fade" aria-hidden="true">
        <div class="modal-dialog  modal-md">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="row">
                                <div class="col-lg-4">
                                    <img id="mealdinnerImage" alt="image" class="" src="" style="width: 120px">
                                </div>
                                <div class="col-lg-8">
                                    <h3 id="mealdinnerName"></h3>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <small>Calorias: </small>
                                                    <small id="mealdinnerCalories"></small>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <small>Carboidratos: </small>
                                                    <small id="mealdinnerCarbs"></small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <small>Proteínas: </small>
                                                    <small id="mealdinnerProteins"></small>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <small>Gorduras: </small>
                                                    <small id="mealdinnerLipids"></small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <h4>Ingredientes</h4>
                                    <ul id="mealdinnerfoods">
                                    </ul>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <h4>Receita</h4>
                                    <p id="mealdinnerDescription"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <environment names="Development,Staging,Production">
        <link rel="stylesheet" href="~/lib/slick-carousel/slick/slick.css" />
        <link rel="stylesheet" href="~/lib/slick-carousel/slick/slick-theme.css" />
        <link rel="stylesheet" href="~/lib/c3/c3.min.css" />
        <link rel="stylesheet" href="~/lib/daterangepicker/daterangepicker-bs3.css" />
        <link rel="stylesheet" href="~/lib/bootstrap-datepicker/dist/css/bootstrap-datepicker3.css" />
        <link rel="stylesheet" href="~/lib/bootstrap-datepicker/dist/css/bootstrap-datepicker3.min.css" />
    </environment>
}

@section Scripts {
    <environment names="Development,Staging,Production">
        <script src="~/lib/daterangepicker/daterangepicker.js"></script>
        <script src="~/lib/bootstrap-datepicker/dist/js/bootstrap-datepicker.js"></script>
        <script src="~/lib/sparkline/jquery.sparkline.min.js"></script>
        <script src="~/lib/slick-carousel/slick/slick.js"></script>
        <script src="~/lib/slick-carousel/slick/slick.min.js"></script>
        <script src="~/lib/nestable/jquery.nestable.js"></script>
        <script src="~/lib/c3/c3.js"></script>
        <script src="~/lib/d3/d3.min.js"></script>


    </environment>

    <script type="text/javascript">
        $(document).ready(function () {

            c3.generate({
                bindto: '#pie',
                data: {
                    columns: [
                        //['Calorias', 200]],
                        ['Carboidratos', @User.FindFirst("Daily_Carbohydrates").Value],
                        ['Proteínas', @User.FindFirst("Daily_Protein").Value],
                        ['Gorduras', @User.FindFirst("Daily_Fats").Value]
                    ],
                    colors: {
                        //data1: '#0000FF',
                        data2: '#f0d500',
                        data3: '#42ccce',
                        data4: '#eed202'
                    },
                    type: 'pie'
                }
            });

            $('.dd-nodrag').nestable('collapseAll');

            $('.dd-nodrag').nestable({
                collapsedClass: 'dd-collapsed',
                group: 1
            }).nestable('collapseAll');

            $('#data_3 .input-group.date').datepicker({
                startView: 2,
                format: 'dd/mm/yyyy',
                language: 'pt-BR',
                todayBtn: "linked",
                keyboardNavigation: false,
                forceParse: false,
                autoclose: true
            });

            $('input[name="daterange"]').daterangepicker();

            $('#reportrange span').html(moment().subtract(29, 'days').format('dd MMMM yyyy') + ' - ' + moment().format('dd MMMM yyyy'));



        });
    </script>

    <script type="text/javascript">
        $(document).ready(function () {

            $("#sparkline1").sparkline([34, 43, 43, 35, 44, 32, 44, 48], {
                type: 'line',
                width: '100%',
                height: '50',
                lineColor: '#1ab394',
                fillColor: "transparent"
            });

        });
    </script>

    <script>
        $("#dietDate").change(function () {
            var date = $("#dietDate").val();
            const myNode = document.getElementById("breackfastmealfoods");
            myNode.innerHTML = '';
            const myNodeb = document.getElementById("mealbrackfastfoods");
            myNodeb.innerHTML = '';
            var units = ['kcal', 'g', 'L', 'ml', 'kg', 'mg', 'µg'];
            $.ajax({
                method: "GET",
                url: "/Diet/GetByDate/",
                contentType: "application/json",
                dataType: "json",
                traditional: true,
                //data: JSON.stringify({ "date": date }),
                data: {
                    'date': JSON.stringify(date),
                    'teste': JSON.stringify("teste")
                },
                success: function (data) {
                    if (data == null) {
                        var id = @User.FindFirst("ID").Value.ToString();
                        $.ajax({
                            method: "GET",
                            url: "/Diet/GenareteDiet/",
                            contentType: "application/json",
                            dataType: "json",
                            traditional: true,
                            data: {
                                'date': JSON.stringify(date),
                                'id': JSON.stringify(id)
                            },
                            success: function (data1) {
                                for (var i = 0; i < data1.length; i++) {
                                    $.ajax({
                                        method: "GET",
                                        url: "/Meal/GetById/" + data1[i],
                                        contentType: "application/json",
                                        dataType: "json",
                                        traditional: true,
                                        success: function (data2) {
                                            if (data2.category == 0) {
                                                document.getElementById('nameMealBreackfast').innerHTML = data2.name;
                                                document.getElementById('mealBreackfastName').innerHTML = data2.name;
                                                document.getElementById('mealBreackfastDescription').innerHTML = data2.description;
                                                document.getElementById('mealbreackfastImage').src = "../img/refeicao/" + data2.id + ".jpg";
                                                document.getElementById('mealbreackfastCalories').innerHTML = data2.total_Calories;
                                                document.getElementById('mealbreackfastCarbs').innerHTML = data2.total_Carbohydrates;
                                                document.getElementById('mealbreackfastProteins').innerHTML = data2.total_Proteins;
                                                document.getElementById('mealbreackfastLipids').innerHTML = data2.total_Lipids;
                                                $.ajax({
                                                    method: "GET",
                                                    url: "/Meal/GetMealFoodsById/" + data2.id,
                                                    contentType: "application/json",
                                                    dataType: "json",
                                                    traditional: true,
                                                    success: function (data3) {
                                                        for (var i = 0; i < data3.length; i++) {
                                                            var food = data3[i];
                                                            $.ajax({
                                                                method: "GET",
                                                                url: "/Meal/GetFoodById/" + data3[i].foodID,
                                                                contentType: "application/json",
                                                                dataType: "json",
                                                                traditional: true,
                                                                success: function (data4) {
                                                                    var a = '<li class="dd-item" data-id="2"><div class="dd-handle"><span class="float-right">' + food.quantity + units[data4.unit] + ' </span><span>' + data4.food_Name + '</span></div></li>';
                                                                    var b = '<li>'+ data4.food_Name +'<span class="float-right">' + food.quantity + units[data4.unit] + ' </span></li>';
                                                                    $("#breackfastmealfoods").append(a);
                                                                    $("#mealbrackfastfoods").append(b);
                                                                },
                                                                failure: function (response) {
                                                                    alert("Falha na comunicação com o servidor.");
                                                                },
                                                                error: function (response) {
                                                                }
                                                            });
                                                        }
                                                    },
                                                    failure: function (response) {
                                                        alert("Falha na comunicação com o servidor.");
                                                    },
                                                    error: function (response) {
                                                    }
                                                });
                                            }

                                            else if (data2.category == 1) {
                                                document.getElementById('nameMeallunch').innerHTML = data2.name;
                                                document.getElementById('meallunchName').innerHTML = data2.name;
                                                document.getElementById('meallunchDescription').innerHTML = data2.description;
                                                document.getElementById('meallunchImage').src = "../img/refeicao/" + data2.id + ".jpg";
                                                document.getElementById('meallunchCalories').innerHTML = data2.total_Calories;
                                                document.getElementById('meallunchCarbs').innerHTML = data2.total_Carbohydrates;
                                                document.getElementById('meallunchProteins').innerHTML = data2.total_Proteins;
                                                document.getElementById('meallunchLipids').innerHTML = data2.total_Lipids;
                                                $.ajax({
                                                    method: "GET",
                                                    url: "/Meal/GetMealFoodsById/" + data2.id,
                                                    contentType: "application/json",
                                                    dataType: "json",
                                                    traditional: true,
                                                    success: function (data3) {
                                                        for (var i = 0; i < data3.length; i++) {
                                                            var food = data3[i];
                                                            $.ajax({
                                                                method: "GET",
                                                                url: "/Meal/GetFoodById/" + data3[i].foodID,
                                                                contentType: "application/json",
                                                                dataType: "json",
                                                                traditional: true,
                                                                success: function (data4) {
                                                                    var a = '<li class="dd-item" data-id="2"><div class="dd-handle"><span class="float-right">' + food.quantity + units[data4.unit] + ' </span><span>' + data4.food_Name + '</span></div></li>';
                                                                    var b = '<li>' + data4.food_Name +'<span class="float-right">' + food.quantity + units[data4.unit] + ' </span></li>';
                                                                    $("#lunchmealfoods").append(a);
                                                                    $("#meallunchfoods").append(b);
                                                                },
                                                                failure: function (response) {
                                                                    alert("Falha na comunicação com o servidor.");
                                                                },
                                                                error: function (response) {
                                                                }
                                                            });
                                                        }
                                                    },
                                                    failure: function (response) {
                                                        alert("Falha na comunicação com o servidor.");
                                                    },
                                                    error: function (response) {
                                                    }
                                                });
                                            }

                                            else if (data2.category == 2) {
                                                document.getElementById('nameMealdinner').innerHTML = data2.name;
                                                document.getElementById('mealdinnerName').innerHTML = data2.name;
                                                document.getElementById('mealdinnerDescription').innerHTML = data2.description;
                                                document.getElementById('mealdinnerImage').src = "../img/refeicao/" + data2.id + ".jpg";
                                                document.getElementById('mealdinnerCalories').innerHTML = data2.total_Calories;
                                                document.getElementById('mealdinnerCarbs').innerHTML = data2.total_Carbohydrates;
                                                document.getElementById('mealdinnerProteins').innerHTML = data2.total_Proteins;
                                                document.getElementById('mealdinnerLipids').innerHTML = data2.total_Lipids;
                                                $.ajax({
                                                    method: "GET",
                                                    url: "/Meal/GetMealFoodsById/" + data2.id,
                                                    contentType: "application/json",
                                                    dataType: "json",
                                                    traditional: true,
                                                    success: function (data3) {
                                                        for (var i = 0; i < data3.length; i++) {
                                                            var food = data3[i];
                                                            $.ajax({
                                                                method: "GET",
                                                                url: "/Meal/GetFoodById/" + data3[i].foodID,
                                                                contentType: "application/json",
                                                                dataType: "json",
                                                                traditional: true,
                                                                success: function (data4) {
                                                                    var a = '<li class="dd-item" data-id="2"><div class="dd-handle"><span class="float-right">' + food.quantity + units[data4.unit] + ' </span><span>' + data4.food_Name + '</span></div></li>';
                                                                    var b = '<li>' + data4.food_Name + '<span class="float-right">' + food.quantity + units[data4.unit] + ' </span></li>';
                                                                    $("#dinnermealfoods").append(a);
                                                                    $("#mealdinnerfoods").append(b);
                                                                },
                                                                failure: function (response) {
                                                                    alert("Falha na comunicação com o servidor.");
                                                                },
                                                                error: function (response) {
                                                                }
                                                            });
                                                        }
                                                    },
                                                    failure: function (response) {
                                                        alert("Falha na comunicação com o servidor.");
                                                    },
                                                    error: function (response) {
                                                    }
                                                });

                                            }
                                            
                                        },
                                        failure: function (response) {
                                            alert("Falha na comunicação com o servidor.");
                                        },
                                        error: function (response) {
                                        }
                                    });

                                }

                            },
                            failure: function (data2) {
                                alert("Falha na comunicação com o servidor.");
                            },
                            error: function (data2) {
                                alert(':(');
                            }
                        });
                    }
                },
                failure: function (response) {
                    alert("Falha na comunicação com o servidor.");
                },
                error: function (response) {
                }
            });
        });
    </script>
}
