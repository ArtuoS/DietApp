@model MVCPresentationLayer.Models.InsertModels.UserInsertViewModel
@using MVCPresentationLayer.Models.QueryModels
@using BusinessLogicalLayer
@using Common
@using Entities
@using Entities.Interfaces

@{
    List<Food> foods = new List<Food>();
    IFoodService foodService = new FoodBLL();
    User user = new User();
    IFood_CategoryService food_CategoryService = new Food_CategoryBLL();
}

@{
    ViewData["Title"] = "Insert";
}
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-content">
                    <h2>
                        Cadastro
                    </h2>
                    <p>
                        Siga os passos para o cadastro no sistema.
                    </p>

                    <form asp-action="Insert" id="form" class="wizard-big">
                        <h1>Conta</h1>
                        <fieldset>
                            <h2>Informação de perfil</h2>
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="form-group">
                                        <label asp-for="First_Name"></label>
                                        <input asp-for="First_Name" type="text" id="firstName" class="form-control required">
                                        <span asp-validation-for="First_Name" class="text-danger"></span>
                                    </div>
                                    <div class="form-group">
                                        <label asp-for="Last_Name"></label>
                                        <input asp-for="Last_Name" type="text" id="lastName" class="form-control required">
                                        <span asp-validation-for="Last_Name" class="text-danger"></span>
                                    </div>
                                    <div class="form-group">
                                        <label asp-for="Email"></label>
                                        <input asp-for="Email" type="email" id="email" class="form-control required email">
                                        <span asp-validation-for="Email" class="text-danger"></span>
                                    </div>
                                    <div class="form-group">
                                        <label asp-for="Password"></label>
                                        <input asp-for="Password" type="password" id="password" name="password" class="form-control required">
                                        <span asp-validation-for="Password" class="text-danger"></span>
                                    </div>
                                    <div class="form-group">
                                        <label>Confirmar senha</label>
                                        <input id="confirm" name="confirm" type="password" class="form-control required">
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div>
                                        <img class="mx-auto d-block" alt="image" src="~/Images/logo_med.png" />
                                    </div>
                                </div>
                            </div>

                        </fieldset>
                        <h1>Dados</h1>
                        <fieldset>
                            <h2>Dados pessoais</h2>
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="form-group" id="data_3">
                                        <label asp-for="Date_Of_Birthday" class="font-normal"></label>
                                        <div class="input-group date">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input asp-for="Date_Of_Birthday" type="text" id="Date_Of_Birthday" class="form-control date">
                                            <span asp-validation-for="Date_Of_Birthday" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label asp-for="Height"></label>
                                        <input asp-for="Height" type="text" class="touchspin2" id="demo1">
                                        <span asp-validation-for="Height" class="text-danger"></span>
                                    </div>
                                    <div class="form-group">
                                        <label asp-for="Weight"></label>
                                        <input asp-for="Weight" class="touchspin2" id="demo2" type="text">
                                        <span asp-validation-for="Weight" class="text-danger"></span>
                                    </div>
                                    <div class="form-group">
                                        <label asp-for="Gender"></label>
                                        @{
                                            string[] biological_gender = Enum.GetNames(typeof(Entities.Enums.Biological_Gender));
                                        }

                                        <select asp-for="Gender" class="form-control" id="Biological_Gender">
                                            @for (int i = 0; i < biological_gender.Length; i++)
                                            {
                                                <option value="@i">@biological_gender[i]</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </fieldset>

                        <h1>Informação Nutricional</h1>
                        <fieldset>
                            <h2>Informação Nutricional</h2>
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="form-group">
                                        <label asp-for="Daily_Calories" class="text-success"></label>
                                        <div asp-for="Daily_Calories" id="ionrange_1"></div>
                                        <span asp-validation-for="Daily_Calories" class="text-danger"></span>
                                    </div>
                                    <div class="form-group">
                                        <label asp-for="Daily_Carbohydrates" class="text-info"></label>
                                        <div asp-for="Daily_Carbohydrates" id="ionrange_2"></div>
                                        <span asp-validation-for="Daily_Carbohydrates" class="text-danger"></span>
                                    </div>
                                    <div class="form-group">
                                        <label asp-for="Daily_Fats" class="text-warning"></label>
                                        <div asp-for="Daily_Fats" id="ionrange_3"></div>
                                        <span asp-validation-for="Daily_Fats" class="label-danger"></span>
                                    </div>
                                    <div class="form-group">
                                        <label asp-for="Daily_Protein" class="text-danger"></label>
                                        <div asp-for="Daily_Protein" id="ionrange_4"></div>
                                        <span asp-validation-for="Daily_Protein" class="label-danger"></span>
                                    </div>
                                    <div id="ionrange_1"></div>
                                </div>
                            </div>
                        </fieldset>

                        <h1>Restrições</h1>
                        <fieldset>
                            <h2>Restrições, alergias, intolerâncias e escolhas alimentares</h2>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="ibox">
                                        <div class="ibox-content">
                                            <p>
                                                Escolha uma dieta pronta ou selecione alimentos que *não* deseja ter em sua dieta.
                                            </p>
                                            <div class="col-md-6">
                                                <select class="select2_demo_3 form-control">
                                                    <option value="tudo">De tudo</option>
                                                    <option value="lactose">Dieta para intolerantes à lactose</option>
                                                    <option value="gluten">Dieta para intolerantes à glúten</option>
                                                    <option value="vegetariana">Vegetariana</option>
                                                    <option value="ovolactovegetariana">Ovo-Lacto-Vegetariana</option>
                                                    <option value="paleolitica">Paleolítica</option>
                                                </select>
                                            </div>

                                            <div class="col-md-4 b-r">
                                                <select class="select2_demo_4 form-control">

                                                    @foreach (Food_Category category in food_CategoryService.GetAll().Result.Data)
                                                    {
                                                        <option value="@category.ID">@category.Name</option>

                                                        foreach (var food in foodService.GetByCategoryId(category.ID).Result.Data)
                                                        {
                                                            foods.Add(food);
                                                        }
                                                    }


                                                </select>
                                            </div>

                                            <select class="form-control dual_select" multiple>

                                                @foreach (Food food in foods)
                                                {
                                                    <option value="@food.ID">@food.Food_Name</option>
                                                }

                                            </select>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>

    </div>
</div>

@section Styles {
    <environment names="Development,Staging,Production">
        <link rel="stylesheet" href="~/lib/iCheck/custom.css" />
        <link rel="stylesheet" href="~/lib/steps/jquery.steps.css" />
        <link rel="stylesheet" href="~/lib/chosen/bootstrap-chosen.css" />
        <link rel="stylesheet" href="~/lib/daterangepicker/daterangepicker-bs3.css" />
        <link rel="stylesheet" href="~/lib/bootstrap-datepicker/dist/css/bootstrap-datepicker3.css" />
        <link rel="stylesheet" href="~/lib/bootstrap-datepicker/dist/css/bootstrap-datepicker3.min.css" />
        <link rel="stylesheet" href="~/lib/select2/dist/css/select2.css" />
        <link rel="stylesheet" href="~/lib/switchery/switchery.css" />
        <link rel="stylesheet" href="~/lib/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.css" />
        <link rel="stylesheet" href="~/lib/select2/dist/css/select2.min.css" />
        <link rel="stylesheet" href="~/lib/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css" />
        <link rel="stylesheet" href="~/lib/ionRangeSlider/ion.rangeSlider.css" />
        <link rel="stylesheet" href="~/lib/ionRangeSlider/ion.rangeSlider.skinFlat.css" />
    </environment>
}

@section Scripts {
    <environment names="Development,Staging,Production">
        <script src="~/lib/moment/moment.js"></script>
        <script src="~/lib/iCheck/icheck.min.js"></script>
        <script src="~/lib/steps/jquery.steps.min.js"></script>
        <script src="~/lib/validate/jquery.validate.min.js"></script>
        <script src="~/lib/daterangepicker/daterangepicker.js"></script>
        <script src="~/lib/bootstrap-datepicker/dist/js/bootstrap-datepicker.js"></script>
        <script src="~/lib/cropper/dist/cropper.js"></script>
        <script src="~/lib/bootstrap-tagsinput/bootstrap-tagsinput.js"></script>
        <script src="~/lib/dualListbox/jquery.bootstrap-duallistbox.js"></script>
        <script src="~/lib/daterangepicker/daterangepicker.js"></script>
        <script src="~/lib/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
        <script src="~/lib/cropper/dist/cropper.min.js"></script>
        <script src="~/lib/select2/dist/js/select2.min.js"></script>
        <script src="~/lib/nouslider/jquery.nouislider.min.js"></script>
        <script src="~/lib/jasny-bootstrap/dist/js/jasny-bootstrap.js"></script>
        <script src="~/lib/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>
        <script src="~/lib/dualListbox/jquery.bootstrap-duallistbox.js"></script>
        <script src="~/lib/daterangepicker/daterangepicker.js"></script>
        <script src="~/lib/ionRangeSlider/ion.rangeSlider.min.js"></script>

    </environment>


    <script type="text/javascript">
        //var caloria = 0;
        //var idade = 0;
        //var peso = 0;
        //var altura = 0;
        //var genero = 0;
        //var carboidrato = caloria * 0.4;
        //var proteina = caloria * 0.4;
        //var gordura = caloria * 0.2;
        //
        //$(document).ready(function () {
        //    idade = getElemntById("Date_Of_Birthday").value;
        //    peso = getElemntById("demo1").value;
        //    altura = getElemntById("demo2").value;
        //    genero = getElemntById("Biological_Gender").value;
        //
        //   user.Weight = getElemntById("demo1").value;
        //   user.Height = getElemntById("demo2").value;
        //   user.Gender = getElemntById("Biological_Gender").value;
        //
        //    if (genero == 0) {
        //        caloria = (13.397 * peso) + (4.799 * altura) - (5.677 * idade) + 88.362;
        //    }
        //    else {
        //        caloria = (9.247 * peso) + (3.098 * altura) - (4.330 * idade) + 447.593;
        //    }
        //}),

        $(document).ready(function () {
            $("#wizard").steps();
            $("#form").steps({
                bodyTag: "fieldset",
                onStepChanging: function (event, currentIndex, newIndex) {
                    // Always allow going backward even if the current step contains invalid fields!
                    if (currentIndex > newIndex) {
                        return true;
                    }

                    // Forbid suppressing "Warning" step if the user is to young
                    if (newIndex === 3 && Number($("#age").val()) < 18) {
                        return false;
                    }

                    var form = $(this);

                    // Clean up if user went backward before
                    if (currentIndex < newIndex) {
                        // To remove error styles
                        $(".body:eq(" + newIndex + ") label.error", form).remove();
                        $(".body:eq(" + newIndex + ") .error", form).removeClass("error");
                    }

                    // Disable validation on fields that are disabled or hidden.
                    form.validate().settings.ignore = ":disabled,:hidden";

                    // Start validation; Prevent going forward if false
                    return form.valid();
                },
                onStepChanged: function (event, currentIndex, priorIndex) {
                    // Suppress (skip) "Warning" step if the user is old enough.
                    if (currentIndex === 2 && Number($("#age").val()) >= 18) {
                        $(this).steps("next");
                    }

                    // Suppress (skip) "Warning" step if the user is old enough and wants to the previous step.
                    if (currentIndex === 2 && priorIndex === 3) {
                        $(this).steps("previous");
                    }
                },
                onFinishing: function (event, currentIndex) {
                    var form = $(this);

                    // Disable validation on fields that are disabled.
                    // At this point it's recommended to do an overall check (mean ignoring only disabled fields)
                    form.validate().settings.ignore = ":disabled";

                    // Start validation; Prevent form submission if false
                    return form.valid();
                },
                onFinished: function (event, currentIndex) {
                    var form = $(this);

                    // Submit form input
                    form.submit().val;
                }
            }).validate({
                errorPlacement: function (error, element) {
                    element.before(error);
                },
                rules: {
                    confirm: {
                        equalTo: "#password"
                    },
                    '#firstName': {
                        minlength: 3
                    },
                    '#lasttName': {
                        minlength: 3
                    }
                }
            });

            $("#ionrange_1").ionRangeSlider({

                min: 0,
                //from: caloria,
                max: 10000,
                type: 'single',
                step: 10,
                postfix: " gramas",
                prettify: true,
            });

            $("#ionrange_2").ionRangeSlider({
                min: 0,
                max: 10000,
                //from: carboidrato,
                type: 'single',
                step: 10,
                postfix: " gramas",
                prettify: true,
            });

            $("#ionrange_3").ionRangeSlider({
                min: 0,
                max: 10000,
                //from: gordura,
                type: 'single',
                step: 10,
                postfix: " gramas",
                prettify: true,
            });

            $("#ionrange_4").ionRangeSlider({
                min: 0,
                max: 10000,
                //from: proteina,
                type: 'single',
                step: 10,
                postfix: " gramas",
                prettify: true,
            });

            $('.tagsinput').tagsinput({
                tagClass: 'label label-primary'
            });

            $('.dual_select').bootstrapDualListbox({
                selectorMinimalHeight: 160
            });

            $('#data_3 .input-group.date').datepicker({
                startView: 2,
                todayBtn: "linked",
                keyboardNavigation: false,
                forceParse: false,
                autoclose: true
            });

            $('input[name="daterange"]').daterangepicker();

            $('#reportrange span').html(moment().subtract(29, 'days').format('MMMM D, YYYY') + ' - ' + moment().format('MMMM D, YYYY'));

            $('#reportrange').daterangepicker({
                format: 'MM/DD/YYYY',
                startDate: moment().subtract(29, 'days'),
                endDate: moment(),
                minDate: '01/01/2012',
                maxDate: '12/31/2015',
                dateLimit: { days: 60 },
                showDropdowns: true,
                showWeekNumbers: true,
                timePicker: false,
                timePickerIncrement: 1,
                timePicker12Hour: true,
                ranges: {
                    'Today': [moment(), moment()],
                    'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                    'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                    'This Month': [moment().startOf('month'), moment().endOf('month')],
                    'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                },
                opens: 'right',
                drops: 'down',
                buttonClasses: ['btn', 'btn-sm'],
                applyClass: 'btn-primary',
                cancelClass: 'btn-default',
                separator: ' to ',
                locale: {
                    applyLabel: 'Submit',
                    cancelLabel: 'Cancel',
                    fromLabel: 'From',
                    toLabel: 'To',
                    customRangeLabel: 'Custom',
                    daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
                    monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                    firstDay: 1
                }
            }, function (start, end, label) {
                console.log(start.toISOString(), end.toISOString(), label);
                $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
            });

            $(".select2_demo_3").select2({
                placeholder: "Selecione uma dieta",
                allowClear: true
            });

            $("input[id='demo1']").TouchSpin({
                min: 0,
                max: 1000,
                step: 10,
                boostat: 5,
                maxboostedstep: 10,
                postfix: 'cm',
                buttondown_class: 'btn btn-white',
                buttonup_class: 'btn btn-white'
            });

            $("input[id='demo2']").TouchSpin({
                min: 0,
                max: 1000,
                step: 10,
                boostat: 5,
                maxboostedstep: 10,
                postfix: 'kg',
                buttondown_class: 'btn btn-white',
                buttonup_class: 'btn btn-white'
            });
        });
    </script>

    <script type="text/javascript">
        $(function () {
            $("#ionrange_1").click(function (e) {
                tr = $(this).parent().parent();
                var user = new Object();

                $.ajax({
                    method: "POST",
                    url: "/User/Update/",
                    data: JSON.stringify(user),
                    contentType: "application/json",
                    dataType: "json",
                    traditional: true,
                    success: function (response) {
                        if (response.DeuBoa) {
                            $('#respostaServidor').html("Cadastro efetuado com sucesso!")
                            $('#respostaServidor').css({ "color": "green" });
                        }
                        else {
                            $('#respostaServidor').html(response.Erro);
                            $('#respostaServidor').css({ "color": "red" });
                        }
                    },
                    failure: function (response) {
                        alert("Falha na comunicação com o servidor.");
                    },
                    error: function (response) {
                    }
                });
                e.preventDefault();
            });
        });



    </script>
}